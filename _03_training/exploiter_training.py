"""Configuration helpers for exploiter training.

This module defines ExploiterConfig used by exploit-patch workflows.
It is intentionally minimal and focused on configuration validation.
"""

from __future__ import annotations

from dataclasses import asdict, dataclass
from typing import Any


@dataclass
class ExploiterConfig:
    """Configuration for exploiter training loops.

    Attributes:
        max_iterations: Maximum training iterations for an exploiter.
        games_per_iteration: Number of games generated per iteration.
        win_rate_threshold: Target win rate to stop training.
        learning_rate: Optimizer learning rate for exploiter model.
        batch_size: PPO minibatch size for exploiter updates.
    """

    max_iterations: int = 200
    games_per_iteration: int = 256
    win_rate_threshold: float = 0.7
    learning_rate: float = 1e-4
    batch_size: int = 512

    def validate(self) -> None:
        """Validate configuration values."""
        if self.max_iterations <= 0:
            raise ValueError("max_iterations must be positive")
        if self.games_per_iteration <= 0:
            raise ValueError("games_per_iteration must be positive")
        if not (0.0 < self.win_rate_threshold <= 1.0):
            raise ValueError("win_rate_threshold must be in (0, 1]")
        if self.learning_rate <= 0:
            raise ValueError("learning_rate must be positive")
        if self.batch_size <= 0:
            raise ValueError("batch_size must be positive")

    def to_dict(self) -> dict[str, Any]:
        """Serialize to dictionary."""
        return asdict(self)

    @classmethod
    def from_dict(cls, data: dict[str, Any]) -> ExploiterConfig:
        """Deserialize from dictionary, ignoring unknown keys."""
        known = {field: data[field] for field in cls.__dataclass_fields__ if field in data}
        return cls(**known)


__all__ = ["ExploiterConfig"]
